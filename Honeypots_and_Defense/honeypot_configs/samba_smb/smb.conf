[global]
# --- PHẦN 1: GIẢ LẬP WINDOWS SERVER 2019 (GIỮ NGUYÊN) ---
workgroup = WORKGROUP
server string = Windows Server 2019 Standard
netbios name = FILE-SERVER

# Bắt buộc dùng SMB2/3 (Chuẩn hiện đại để lừa Nmap)
server min protocol = SMB2
server max protocol = SMB3

# --- PHẦN 2: CẤU HÌNH LOGGING CHO PYTHON SCRIPT & ELK (QUAN TRỌNG) ---
# Kích hoạt module audit và recycle (thùng rác)
vfs objects = full_audit recycle

# 1. ĐỊNH DẠNG LOG (SỬA LẠI): Thêm tiền tố 'smbd_audit|' để Python cắt chuỗi
full_audit:prefix = smbd_audit|%u|%I|%m|%S

# 2. HÀNH ĐỘNG CẦN BẮT (SỬA LẠI):
# - Thêm 'opendir' -> Để Python biết khi nào cần Restore file
# - Thêm 'close' -> Để Python biết khi nào file upload xong (để bắt malware)
full_audit:success = connect opendir chdir open read pread write pwrite close rename unlink rmdir mkdir

# Các cấu hình log hệ thống
full_audit:failure = none
full_audit:facility = local7
full_audit:priority = NOTICE

# Cấu hình Recycle Bin (Thùng rác dự phòng - Option thêm)
recycle:repository = .recycle
recycle:keeptree = yes
recycle:versions = yes

# --- CẤU HÌNH CƠ BẢN KHÁC ---
security = user
map to guest = Bad User
log file = /var/log/samba/log.%m
max log size = 1000
logging = file

# --- PHẦN 3: TẠO THƯ MỤC MỒI NHỬ (BAIT) ---
[TaiLieuNoiBo]
comment = Du lieu Ke toan - KHONG XOA
path = /srv/samba/tailieu
browsable = yes
guest ok = yes
read only = no
create mask = 0777
directory mask = 0777

# --- Audit Configuration ---
vfs objects = full_audit
full_audit:prefix = smbd_audit|%u|%I|%m|%S
full_audit:success = mkdir rename unlink rmdir pwrite open
full_audit:failure = none
full_audit:facility = local7
full_audit:priority = NOTICE
